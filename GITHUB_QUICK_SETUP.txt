# ğŸš€ GitHub API - Quick Setup Guide

## TÃ³m Táº¯t
Há»‡ thá»‘ng sáº½ **tá»± Ä‘á»™ng** update `data/keys` files qua GitHub API khi khÃ¡ch hÃ ng thanh toÃ¡n thÃ nh cÃ´ng.

---

## âš¡ CÃ¡c BÆ°á»›c Thiáº¿t Láº­p

### 1ï¸âƒ£ Táº¡o GitHub Token (1 phÃºt)
```
GitHub â†’ Settings â†’ Developer settings â†’ Personal access tokens â†’ Generate new token (classic)
Chá»n scope: repo âœ…
Copy token: ghp_xxxxxxxxxxxxxxxxxxxx
```

### 2ï¸âƒ£ Set Environment Variables

**TrÃªn Fly.io:**
```bash
fly secrets set GITHUB_TOKEN=ghp_xxx
fly secrets set GITHUB_OWNER=abcxyznd
fly secrets set GITHUB_REPO=keys
```

**Local (.env):**
```
GITHUB_TOKEN=ghp_xxx
GITHUB_OWNER=abcxyznd
GITHUB_REPO=keys
```

### 3ï¸âƒ£ Deploy
```bash
git push
fly deploy
```

---

## âœ¨ Nhá»¯ng GÃ¬ Xáº£y Ra

### Khi khÃ¡ch hÃ ng thanh toÃ¡n:
```
Thanh toÃ¡n âœ…
  â†“
Gá»­i key email âœ…
  â†“
GitHub API tá»± Ä‘á»™ng:
  â”œâ”€ XÃ³a key tá»« data/keys/key[period].txt
  â””â”€ LÆ°u key vÃ o data/keys/key_solved.txt
  â†“
Táº¥t cáº£ xong âœ…
```

### Logs báº¡n sáº½ tháº¥y:
```
[GITHUB] âœ… GitHub API enabled: abcxyznd/keys
[GITHUB] ğŸ”„ Starting delete_key_and_save_solved for key: 666Cheat-day-xxx
[GITHUB] âœ… Removed key from data/keys/key1d.txt
[GITHUB] âœ… Saved key to data/keys/key_solved.txt
[DELETE_KEY] âœ… GitHub API update successful
```

---

## ğŸ“Š Commit History
Má»—i láº§n key Ä‘Æ°á»£c gá»­i, GitHub sáº½ cÃ³ 2 commits:
- `Remove key via API`
- `Add solved key via API`

Xem táº¡i: https://github.com/abcxyznd/keys/commits

---

## ğŸ”„ Fallback Mode
Náº¿u GitHub API bá»‹ lá»—i hoáº·c `GITHUB_TOKEN` khÃ´ng set:
- Há»‡ thá»‘ng sáº½ **tá»± Ä‘á»™ng fallback** sang local file operations
- Má»i thá»© váº«n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng

---

## ğŸ“‹ Environment Variables Required

| Variable | Value | VÃ­ dá»¥ |
|----------|-------|-------|
| `GITHUB_TOKEN` | Your PAT | `ghp_xxxxxx` |
| `GITHUB_OWNER` | Your username | `abcxyznd` |
| `GITHUB_REPO` | Repo name | `keys` |
| `SENDGRID_API_KEY` | SendGrid key | `SG.xxx` |
| `FROM_EMAIL` | Sender email | `noreply@xxx.com` |

---

## ğŸ” Security
- âœ… Token khÃ´ng Ä‘Æ°á»£c commit (lÆ°u trong environment)
- âœ… Token chá»‰ cÃ³ quyá»n `repo` (khÃ´ng thá»ƒ xÃ³a repo)
- âœ… CÃ³ thá»ƒ revoke token báº¥t cá»© lÃºc nÃ o
- âœ… Táº¥t cáº£ updates Ä‘Æ°á»£c log trÃªn GitHub

---

## â“ Debugging

### Test GitHub connection:
```bash
python -c "from github_helper import get_github_manager; print(get_github_manager().use_github)"
```

### Check environment:
```bash
fly secrets list
```

### View logs:
```bash
fly logs --num 100
```

---

## ğŸ“ Xong!
BÃ¢y giá»:
1. Deploy code lÃªn Fly.io
2. Set `GITHUB_TOKEN`, `GITHUB_OWNER`, `GITHUB_REPO`
3. Test thanh toÃ¡n â†’ Key sáº½ tá»± Ä‘á»™ng update trÃªn GitHub

ThÃªm chi tiáº¿t xem: [GITHUB_SETUP.md](GITHUB_SETUP.md)
