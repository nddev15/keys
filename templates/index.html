<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muakey.cloud</title>
      <meta name="description" content="Muakey.cloud - Shop Key R·∫ª Nh·∫•t" />

   <!-- Favicon -->
    <link rel="icon" href="../img/key.png" type="image/x-icon" />
    <link rel="shortcut icon" href="../img/key.png" type="image/x-icon" />
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Rajdhani:wght@500;700&display=swap');
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;font-family:'Rajdhani',sans-serif;background:radial-gradient(circle at 50% -20%,#0d1117,#05060a 80%);color:#e5f6ff;}
body{display:flex;justify-content:center;align-items:flex-start;padding:20px;overflow-y:auto;}
body::before{content:"";position:fixed;top:0;left:0;right:0;bottom:0;background-image:linear-gradient(90deg,rgba(0,255,255,0.04) 1px,transparent 1px),linear-gradient(rgba(0,255,255,0.04) 1px,transparent 1px);background-size:40px 40px;animation:moveGrid 10s linear infinite;z-index:0;pointer-events:none;}
@keyframes moveGrid{from{background-position:0 0,0 0;}to{background-position:40px 40px,40px 40px;}}
.wrapper{width:100%;max-width:360px;z-index:2;display:flex;flex-direction:column;gap:16px;align-items:center;}
.terminal{width:100%;background:#0f1113;border:2px solid rgba(0,255,136,0.12);border-radius:14px;box-shadow:0 0 22px rgba(0,255,136,0.06);overflow:hidden;}
.terminal-header{background:linear-gradient(90deg,#00ff99,#00cc88);color:#00110a;padding:8px 12px;font-weight:700;font-size:13px;font-family:'Orbitron',sans-serif;}
.terminal-body{padding:10px;font-size:13px;color:#00ff99;height:100px;max-height:250px;overflow-y:auto;line-height:1.35;white-space:pre-wrap;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,'Courier New',monospace;}
.terminal-line::before{content:"> ";color:#9cffb8;}
.card{position:relative;background:rgba(10,15,25,0.92);border:2px solid rgba(0,255,255,0.18);border-radius:14px;box-shadow:0 0 30px rgba(0,255,255,0.06),inset 0 0 10px rgba(0,255,255,0.03);padding:0;width:100%;text-align:center;backdrop-filter:blur(8px);transition:transform .22s ease,box-shadow .22s ease;}
.card:hover{transform:translateY(-3px);box-shadow:0 8px 40px rgba(0,255,255,0.08);}
.card-header{background:#0098a6;font-family:'Orbitron',sans-serif;font-weight:700;font-size:13px;padding:12px 16px;border-top-left-radius:12px;border-top-right-radius:12px;text-align:left;box-shadow:inset 0 -1px 4px rgba(0,255,255,0.05);}
.card-body{padding:16px;text-align:center;}
.card-body select,.card-body input[type="email"],.card-body input[type="text"],.card-body button{width:92%;margin:6px 0;padding:8px 10px;border-radius:8px;border:1px solid rgba(0,255,255,0.08);background:rgba(0,10,20,0.6);color:#bffcff;font-size:13px;}
.card-body button{background:linear-gradient(90deg,#00eaff,#0066ff);color:#00121a;font-weight:800;cursor:pointer;transition:transform .15s ease,box-shadow .15s ease;}
.card-body button:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,180,255,0.08);}
h2{font-size:17px;color:#00eaff;margin:6px 0 10px;text-shadow:0 0 8px #00eaff;}
.text1{font-size:17px;color:#00f7ff;margin:6px 0 10px;}
label{display:block;font-size:13px;color:#88faff;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.6px;}
.qr img{width:180px;max-width:100%;height:auto;margin:10px 0;border-radius:8px;border:2px solid rgba(0,255,255,0.08);box-shadow:0 0 12px rgba(0,255,255,0.04);}
.video {
  max-width: 500px; /* chi·ªÅu ngang t·ªëi ƒëa */
  width: 100%;      /* co gi√£n theo container n·∫øu nh·ªè h∆°n max */
  height: auto;     /* chi·ªÅu cao t·ª± ƒë·ªông theo t·ªâ l·ªá */
  margin: 10px 0;
  border-radius: 8px;
  border: 2px solid rgba(0, 255, 255, 0.08);
  box-shadow: 0 0 12px rgba(0, 255, 255, 0.04);
}

#status{margin-top:8px;font-weight:700;font-size:13px;color:#7fff9a;text-shadow:0 0 6px rgba(0,255,159,0.06);word-break:break-word;white-space:normal;line-height:1.3;text-align:center;max-height:64px;overflow-y:auto;}
.footer{margin-top:12px;font-size:11px;color:#9ab;border-top:1px solid rgba(0,255,255,0.04);padding-top:8px;text-align:center;}
</style>
</head>
<body>
<div class="wrapper">
  <div class="terminal">
    <div class="terminal-header">>_ Terminal</div>
    <div class="terminal-body" id="terminal" aria-live="polite"></div>
  </div>

  <div class="card">
    <div class="card-header">üíª Mua key ngay</div>
    <div class="card-body">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:8px;">
        <label class="text1" for="duration" style="margin:0;flex:1;">Ch·ªçn th·ªùi h·∫°n:</label>
        <a href="https://tinyurl.com/2ataljdt" target="_blank" style="padding:8px 12px;background:linear-gradient(90deg,#ff9900,#ff6600);color:#00121a;font-weight:700;border-radius:8px;border:none;cursor:pointer;font-size:12px;text-decoration:none;white-space:nowrap;transition:transform .15s ease,box-shadow .15s ease;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 8px 24px rgba(255,102,0,0.3)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'">üì±Demo Menu</a>
      </div>
      <select id="duration">
        {% for d in durations %}
          {% if d.key_count > 0 %}
            <option value="{{ d.value }}" data-amount="{{ d.amount }}" data-key-count="{{ d.key_count }}" data-label="{{ d.label }}">
              {{ d.label }} ‚Äî {{ "{:,}".format(d.amount) }} VND ({{ d.key_count }} key)
            </option>
          {% else %}
            <option value="{{ d.value }}" data-amount="{{ d.amount }}" data-key-count="{{ d.key_count }}" data-label="{{ d.label }}" disabled style="color:#333;">
              {{ d.label }} ‚Äî h·∫øt key
            </option>
          {% endif %}
        {% endfor %}
      </select>

      <p class="text1">N·ªôi dung: <b id="code">{{ code }}</b></p>
      <div class="qr"><img id="qrImage" alt="VietQR"></div>

      <input type="email" id="email" placeholder="Nh·∫≠p email ƒë·ªÉ nh·∫≠n key üîë">
      
      <div style="display:flex;gap:8px;width:92%;margin:6px auto;">
        <input type="text" id="coupon" placeholder="M√£ gi·∫£m gi√° (n·∫øu c√≥)" style="flex:1;">
        <button id="testCouponBtn" style="width:auto;padding:8px 12px;">X√°c Nh·∫≠n</button>
      </div>
      <p id="couponInfo" style="font-size:12px;color:#ffaa00;margin:4px 0;"></p>
      
      <p id="keyStatus" style="display:none;margin:12px 0;padding:12px;background:rgba(0,200,100,0.15);border:1px solid rgba(0,200,100,0.4);border-radius:6px;color:#00cc66;font-size:13px;">
        <b>‚úÖ Key c·ªßa b·∫°n:</b><br>
        <span id="receivedKey" style="font-family:monospace;font-weight:bold;word-break:break-all;"></span>
      </p>
      
      <br>
      <button id="checkBtn">Nh·∫≠n Key</button>
      <p id="status"></p>
    </div>
  </div>

  <div class="card">
    <div class="card-header">üìó H∆∞·ªõng d·∫´n</div>
    <div class="card-body">
        <video class="video" controls autoplay>
          <source src="https://github.com/WeansHHN/me/raw/refs/heads/main/support.mp4" type="video/mp4">
          Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ video.
        </video>

        <p>- Ae l∆∞u √Ω xem k·ªπ video, tr√°nh b·ªã sai s√≥t!</p>
        <p>- B·∫•t k√¨ th·∫Øc m·∫Øc n√†o ib <a href="https://zalo.me/0375053471" target="_blank" style="color:#00eaff; text-decoration:none;">Zalo</a> ho·∫∑c <a href="https://t.me/vaicaunoicokhiennguoithay_doi" target="_blank" style="color:#00eaff; text-decoration:none;">Telegram</a></p>
    </div>
  </div>

  <div class="footer">¬© 2026 <span style="color:#00eaff;">Muakey.pro</span> | By <b>tuiducios.xyz</b></div><br>
</div>

<script>
const terminalEl = document.getElementById('terminal');
const lines = [
  ":3 ‚ù§Ô∏è‚Äçüî• üáªüá≥",
  "Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Cheat AOV Store",
  "N·∫øu b·∫°n l√† ng∆∞·ªùi m·ªõi, h√£y k√©o xu·ªëng ph·∫ßn h∆∞·ªõng d·∫´n ƒë·ªÉ t√¨m hi·ªÉu nh√©!!",
  "C√≤n n·∫øu b·∫°n l√† kh√°ch quen, c·∫£m ∆°n b·∫°n ƒë√£ ·ªßng h·ªô:3",
  "666CHEAT With Love <3"
];
let lineIndex=0, charIndex=0, currentLine='';

function typeTick(){
  if(lineIndex>=lines.length){ return; }
  const line=lines[lineIndex];
  if(charIndex<line.length){
    currentLine+=line[charIndex++];
    renderTerminal(currentLine+'‚ñå');
    terminalEl.scrollTop=terminalEl.scrollHeight;
    setTimeout(typeTick,30+Math.random()*40);
  }else{
    appendLine(currentLine);
    currentLine=''; charIndex=0; lineIndex++;
    setTimeout(typeTick,400);
  }
}

function renderTerminal(html){
  const last=terminalEl.lastElementChild;
  if(last&&last.classList.contains('typing')) last.innerHTML=html;
  else{
    const div=document.createElement('div');
    div.className='terminal-line typing';
    div.innerHTML=html;
    terminalEl.appendChild(div);
  }
}

function appendLine(text){
  const last=terminalEl.lastElementChild;
  if(last&&last.classList.contains('typing')){
    last.classList.remove('typing');
    last.innerHTML=text;
  }else{
    const div=document.createElement('div');
    div.className='terminal-line';
    div.textContent=text;
    terminalEl.appendChild(div);
  }
  terminalEl.scrollTop=terminalEl.scrollHeight;
}

setTimeout(typeTick,500);

const uid="{{ uid }}";
const code="{{ code }}";
const qrImage=document.getElementById('qrImage');
const durationSelect=document.getElementById('duration');
const statusEl=document.getElementById('status');
const couponInput=document.getElementById('coupon');
const couponInfoEl=document.getElementById('couponInfo');
const testCouponBtn=document.getElementById('testCouponBtn');

// Ph·∫ßn t·ª≠ ƒë·ªÉ hi·ªÉn th·ªã th√¥ng tin gi·∫£m gi√° (n·∫øu c·∫ßn)
const promoInfoEl = { innerText: '' };
let appliedDiscount = 0; // L∆∞u % gi·∫£m gi√° ƒë√£ √°p d·ª•ng

function updateDurationDisplay(){
  const selected=durationSelect.options[durationSelect.selectedIndex];
  let originalAmount=parseInt(selected.getAttribute("data-amount").replace(/,/g, ""));
  let discountedAmount=originalAmount-(originalAmount*appliedDiscount/100);
  
  if(appliedDiscount > 0){
    selected.text=selected.getAttribute("data-label")+" ‚Äî "+discountedAmount.toLocaleString()+" VND ("+selected.getAttribute("data-key-count")+" key) [ƒê√£ √°p gi·∫£m "+appliedDiscount+"%]";
  }else{
    selected.text=selected.getAttribute("data-label")+" ‚Äî "+originalAmount.toLocaleString()+" VND ("+selected.getAttribute("data-key-count")+" key)";
  }
}

const btn=document.getElementById('checkBtn');

function updateQR(amount){
  const selected=durationSelect.options[durationSelect.selectedIndex];
  const qrAmount=amount || selected.getAttribute("data-amount");
  qrImage.src=`https://img.vietqr.io/image/MB-98582233445566-png.png?amount=${qrAmount}&addInfo=${code}&accountName=NGUYEN%20VU%20NGOC%20DUC`;
}

updateQR();
durationSelect.addEventListener('change',()=>{
  updateQR();
  updateDurationDisplay(); // C·∫≠p nh·∫≠t gi√° khi thay ƒë·ªïi th·ªùi h·∫°n
});

function startCooldown(sec){
  let time=sec;
  btn.disabled=true;
  btn.innerText=`Ch·ªù ${time}s...`;
  const timer=setInterval(()=>{
    time--;
    if(time<=0){ clearInterval(timer); btn.disabled=false; btn.innerText="Nh·∫≠n Key"; }
    else btn.innerText=`Ch·ªù ${time}s...`;
  },1000);
}

// Test coupon button
testCouponBtn.addEventListener('click',async ()=>{
  const couponCode=couponInput.value.trim().toUpperCase();
  const selected=durationSelect.options[durationSelect.selectedIndex];
  const period=selected.value;

  if(!couponCode){
    couponInfoEl.innerText="‚ùå Nh·∫≠p m√£ gi·∫£m gi√°!";
    couponInfoEl.style.color="#ff5555";
    return;
  }

  testCouponBtn.disabled=true;
  testCouponBtn.innerText="ƒêang ki·ªÉm tra...";
  couponInfoEl.innerText="üîç ƒêang ki·ªÉm tra...";

  try{
    const res=await fetch("/check_coupon",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({coupon_code:couponCode,period})
    });
    const data=await res.json();

    if(data.status==="ok"){
      const c=data.coupon||{};
      const discount=c.discount||0;
      appliedDiscount=discount; // L∆∞u discount ƒë√£ √°p d·ª•ng
      const selected=durationSelect.options[durationSelect.selectedIndex];
      let originalAmount=parseInt(selected.getAttribute("data-amount").replace(/,/g, ""));
      let discountedAmount=originalAmount-(originalAmount*discount/100);
      couponInfoEl.innerText=`‚úÖ M√£ h·ª£p l·ªá! Gi·∫£m ${discount}% | C√≤n ${c.uses_left} l∆∞·ª£t | H·∫øt h·∫°n: ${c.expires_at||'Kh√¥ng gi·ªõi h·∫°n'} | S·ªë ti·ªÅn sau khi gi·∫£m: ${discountedAmount.toLocaleString()}ƒë`;
      couponInfoEl.style.color="#66ff99";
      updateDurationDisplay(); // C·∫≠p nh·∫≠t gi√° tr√™n dropdown
      // T·ª± ƒë·ªông c·∫≠p nh·∫≠t QR sau khi x√°c nh·∫≠n coupon
      updateQR(discountedAmount);
    }else{
      couponInfoEl.innerText=`‚ùå ${data.message||'M√£ kh√¥ng h·ª£p l·ªá'}`;
      couponInfoEl.style.color="#ff5555";
    }
  }catch(e){
    couponInfoEl.innerText="‚ùå L·ªói k·∫øt n·ªëi!";
    couponInfoEl.style.color="#ff5555";
    console.error(e);
  }

  testCouponBtn.disabled=false;
  testCouponBtn.innerText="X√°c Nh·∫≠n";
});

btn.addEventListener('click',async ()=>{
  const email=document.getElementById('email').value;
  const promo_code=couponInput.value.trim().toUpperCase();
  const selected=durationSelect.options[durationSelect.selectedIndex];
  const period=selected.value;
  const amount=parseInt(selected.getAttribute("data-amount").replace(/,/g, ""));
  
  // KH√îNG t√≠nh discount ·ªü ƒë√¢y! Backend s·∫Ω t√≠nh

  if(!email){ alert("‚ö†Ô∏è Nh·∫≠p email tr∆∞·ªõc!"); return; }

  btn.disabled=true;
  btn.innerText="ƒêang ki·ªÉm tra...";
  statusEl.innerText="üîç ƒêang x√°c minh thanh to√°n...";
  promoInfoEl.innerText="";

  try{
    const res=await fetch("/check_mb_payment",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({uid,email,period,amount,promo_code})
    });
    const data=await res.json();

    if(data.status==="ok"){
      const d=data.data||{};
      const discount=d.discount_percent||0;
      const finalAmount=d.final_amount||amount;
      const receivedKey=d.key||"N/A";

      statusEl.innerText=`S·ªë ti·ªÅn: ${finalAmount.toLocaleString()}ƒë`;

      updateQR(finalAmount);
      
      // Hi·ªÉn th·ªã key ·ªü √¥ ri√™ng, KH√îNG thay ƒë·ªïi m√£ n·ªôi dung
      const keyStatusEl=document.getElementById('keyStatus');
      const receivedKeyEl=document.getElementById('receivedKey');
      receivedKeyEl.innerText=receivedKey;
      keyStatusEl.style.display='block';

      statusEl.innerText+="\n‚úÖ Th√†nh c√¥ng! Trang s·∫Ω reload sau 3s...";
      setTimeout(()=>location.reload(),3000);
    }else{
      statusEl.innerText=data.message||"‚ùå L·ªói!";
    }
  }catch(e){
    statusEl.innerText="‚ùå L·ªói k·∫øt n·ªëi server!";
    console.error(e);
  }

  startCooldown(35);
});

// // ========== Pagination Controls ==========
// let currentPage = 1;
// const paginationContent = [
//   {
//     title: "Trang 1 - Mua Key",
//     description: "Ch·ªçn g√≥i key ph√π h·ª£p v·ªõi nhu c·∫ßu c·ªßa b·∫°n"
//   },
//   {
//     title: "Trang 2 - H∆∞·ªõng d·∫´n chi ti·∫øt",
//     description: "C√°ch s·ª≠ d·ª•ng key v√† c√°c l∆∞u √Ω quan tr·ªçng"
//   },
//   {
//     title: "Trang 3 - H·ªó tr·ª£ v√† FAQ",
//     description: "C√°c c√¢u h·ªèi th∆∞·ªùng g·∫∑p v√† li√™n h·ªá h·ªó tr·ª£"
//   }
// ];

// const backBtn = document.getElementById('backBtn');
// const nextBtn = document.getElementById('nextBtn');
// const pageInfo = document.getElementById('pageInfo');

// function updatePaginationUI() {
//   pageInfo.innerText = `Trang ${currentPage}/${paginationContent.length}`;
//   backBtn.disabled = currentPage === 1;
//   nextBtn.disabled = currentPage === paginationContent.length;
// }

// backBtn.addEventListener('click', () => {
//   if (currentPage > 1) {
//     currentPage--;
//     updatePaginationUI();
//     showPageContent();
//     window.scrollTo({ top: 0, behavior: 'smooth' });
//   }
// });

// nextBtn.addEventListener('click', () => {
//   if (currentPage < paginationContent.length) {
//     currentPage++;
//     updatePaginationUI();
//     showPageContent();
//     window.scrollTo({ top: 0, behavior: 'smooth' });
//   }
// });

// function showPageContent() {
//   const cardHeader = document.querySelector('.card:nth-child(2) .card-header');
//   const cardBody = document.querySelector('.card:nth-child(2) .card-body');
  
//   if (currentPage === 1) {
//     cardHeader.innerText = 'üíª Mua key ngay';
//     // Reset to original content
//     location.reload();
//   } else if (currentPage === 2) {
//     cardHeader.innerText = 'üìò H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng';
//     cardBody.innerHTML = `
//       <div style="text-align:left;font-size:13px;line-height:1.6;color:#bffcff;">
//         <h3 style="color:#00eaff;margin-bottom:10px;">üìñ C√°ch s·ª≠ d·ª•ng key AOV:</h3>
//         <ol style="margin-left:20px;">
//           <li>M·ªü ·ª©ng d·ª•ng AOV tr√™n ƒëi·ªán tho·∫°i</li>
//           <li>Truy c·∫≠p ph·∫ßn "C·ª≠a h√†ng" ho·∫∑c "Shop"</li>
//           <li>Ch·ªçn "N·∫°p Key" ho·∫∑c "Redeem Code"</li>
//           <li>Paste m√£ key v·ª´a nh·∫≠n v√†o</li>
//           <li>Nh·∫•n "X√°c nh·∫≠n" ƒë·ªÉ nh·∫≠n qu√†</li>
//         </ol>
//         <h3 style="color:#00eaff;margin:15px 0 10px;">‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</h3>
//         <ul style="margin-left:20px;">
//           <li>M·ªói key ch·ªâ s·ª≠ d·ª•ng ƒë∆∞·ª£c 1 l·∫ßn duy nh·∫•t</li>
//           <li>Key h·∫øt h·∫°n sau th·ªùi gian quy ƒë·ªãnh</li>
//           <li>Kh√¥ng ho√†n ti·ªÅn n·∫øu nh·∫≠p sai key</li>
//           <li>Gi·ªØ k√≠n key c·ªßa b·∫°n, tr√°nh chia s·∫ª</li>
//         </ul>
//       </div>
//     `;
//   } else if (currentPage === 3) {
//     cardHeader.innerText = '‚ùì FAQ & H·ªó tr·ª£';
//     cardBody.innerHTML = `
//       <div style="text-align:left;font-size:13px;line-height:1.6;color:#bffcff;">
//         <h3 style="color:#00eaff;margin-bottom:10px;">‚ùì C√°c c√¢u h·ªèi th∆∞·ªùng g·∫∑p:</h3>
//         <div style="margin-bottom:12px;">
//           <strong style="color:#00ff99;">Q: Key h·∫øt h·∫°n sau bao l√¢u?</strong><br>
//           A: T√πy v√†o g√≥i b·∫°n mua (1 ng√†y, 7 ng√†y, 1 th√°ng, 3 th√°ng)
//         </div>
//         <div style="margin-bottom:12px;">
//           <strong style="color:#00ff99;">Q: T√¥i nh·∫≠p sai key, ph·∫£i l√†m sao?</strong><br>
//           A: Li√™n h·ªá h·ªó tr·ª£ s·ªõm nh·∫•t ƒë·ªÉ ƒë∆∞·ª£c gi√∫p ƒë·ª°
//         </div>
//         <div style="margin-bottom:12px;">
//           <strong style="color:#00ff99;">Q: C√≥ c√°ch n√†o r·∫ª h∆°n kh√¥ng?</strong><br>
//           A: S·ª≠ d·ª•ng m√£ gi·∫£m gi√° n·∫øu b·∫°n c√≥
//         </div>
//         <h3 style="color:#00eaff;margin:15px 0 10px;">üìû Li√™n h·ªá h·ªó tr·ª£:</h3>
//         <p>Zalo: <a href="https://zalo.me/0375053471" target="_blank" style="color:#00eaff;text-decoration:none;">0375053471</a></p>
//         <p>Telegram: <a href="https://t.me/vaicaunoicokhiennguoithay_doi" target="_blank" style="color:#00eaff;text-decoration:none;">@SupportTeam</a></p>
//       </div>
//     `;
//   }
// }

// // Initialize pagination UI
// updatePaginationUI();

</script>
</body>
</html>
