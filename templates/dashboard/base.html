<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Muakey.cloud -Admin Dashboard{% endblock %}</title>
    <link rel="icon" href="https://files.catbox.moe/zrq6pf.png" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;500;600;700;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --header-height: 64px;
            --sidebar-width: 260px;
        }

        /* Light Mode (Default) */
        body {
            --text-primary: #000;
            --text-secondary: rgba(0, 0, 0, 0.6);
            --bg-overlay: rgba(0, 0, 0, 0.4);
            --glass-bg: rgba(255, 255, 255, 0.45);
            --glass-bg-strong: rgba(255, 255, 255, 0.5);
            --glass-bg-light: rgba(255, 255, 255, 0.35);
            --border-color: rgba(0, 0, 0, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.1);
            --hover-bg: rgba(255, 255, 255, 0.5);
        }

        /* Dark Mode */
        body[data-theme="dark"] {
            --text-primary: #fff;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --bg-overlay: rgba(0, 0, 0, 0.7);
            --glass-bg: rgba(0, 0, 0, 0.45);
            --glass-bg-strong: rgba(0, 0, 0, 0.55);
            --glass-bg-light: rgba(0, 0, 0, 0.35);
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.3);
            --hover-bg: rgba(0, 0, 0, 0.6);
        }

        /* Mixed Mode (Half Dark Half Light) */
        body[data-theme="mixed"] .header,
        body[data-theme="mixed"] .header-content,
        body[data-theme="mixed"] .logout-btn,
        body[data-theme="mixed"] .user-info,
        body[data-theme="mixed"] .logo-icon,
        body[data-theme="mixed"] .theme-toggle {
            --text-primary: #fff;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --glass-bg: rgba(0, 0, 0, 0.45);
            --glass-bg-strong: rgba(0, 0, 0, 0.55);
            --glass-bg-light: rgba(0, 0, 0, 0.35);
            --border-color: rgba(255, 255, 255, 0.1);
            --hover-bg: rgba(0, 0, 0, 0.6);
        }

        body[data-theme="mixed"] .sidebar {
            --text-primary: #000;
            --text-secondary: rgba(0, 0, 0, 0.6);
            --glass-bg: rgba(255, 255, 255, 0.45);
            --glass-bg-strong: rgba(255, 255, 255, 0.5);
            --glass-bg-light: rgba(255, 255, 255, 0.35);
            --border-color: rgba(0, 0, 0, 0.1);
            --hover-bg: rgba(255, 255, 255, 0.5);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: url('https://www.publicdomainpictures.net/pictures/610000/velka/seamless-floral-wallpaper-art-1715193626Gct.jpg') center center;
            background-size: 500px;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-overlay);
            z-index: 0;
            transition: background 0.3s ease;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            z-index: 1000;
            border-bottom: 1px solid var(--border-color);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            background: var(--glass-bg-strong);
            box-shadow: 0 2px 8px var(--shadow-color);
            transition: all 0.3s ease;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 100%;
            padding: 0 24px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 20px;
            color: var(--text-primary);
            text-decoration: none;
        }

        .logo-icon {
            width: 42px;
            height: 42px;
            background: var(--glass-bg-light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 2px 4px var(--shadow-color);
            transition: all 0.3s ease;
        }

        /* Hamburger Menu Button */
        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .menu-btn {
            display: none;
            width: 42px;
            height: 42px;
            background: var(--glass-bg-light);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--text-primary);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 2px 4px var(--shadow-color);
            transition: all 0.3s ease;
        }

        .menu-btn:hover {
            background: var(--hover-bg);
        }

        .menu-btn:active {
            transform: scale(0.95);
        }

        /* Sidebar toggle button for desktop */
        .sidebar-toggle-btn {
            display: flex;
            width: 42px;
            height: 42px;
            background: var(--glass-bg-light);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--text-primary);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 2px 4px var(--shadow-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .sidebar-toggle-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .sidebar-toggle-btn:active::after {
            width: 200px;
            height: 200px;
        }

        .sidebar-toggle-btn:hover {
            background: var(--hover-bg);
        }

        .sidebar-toggle-btn:active {
            transform: scale(0.95);
        }

        /* Sidebar collapsed state */
        body.sidebar-collapsed .sidebar {
            transform: translateX(-100%);
        }

        body.sidebar-collapsed .main-content {
            margin-left: 0;
        }

        /* Theme Toggle Button */
        .theme-toggle {
            padding: 10px 14px;
            background: var(--glass-bg-light);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 2px 4px var(--shadow-color);
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: var(--hover-bg);
        }

        .theme-toggle i {
            font-size: 16px;
        }

        /* Background Customization Button */
        .bg-customize-btn {
            padding: 10px 14px;
            background: var(--glass-bg-light);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 2px 4px var(--shadow-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .bg-customize-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .bg-customize-btn:active::after {
            width: 200px;
            height: 200px;
        }

        .bg-customize-btn:hover {
            background: var(--hover-bg);
        }

        .bg-customize-btn i {
            font-size: 16px;
        }

        /* Font Customization Button */
        .font-customize-btn {
            padding: 10px 14px;
            background: var(--glass-bg-light);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 2px 4px var(--shadow-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .font-customize-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .font-customize-btn:active::after {
            width: 200px;
            height: 200px;
        }

        .font-customize-btn:hover {
            background: var(--hover-bg);
        }

        .font-customize-btn i {
            font-size: 16px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 14px;
            background: var(--glass-bg-light);
            border-radius: 12px;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 2px 4px var(--shadow-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .user-info::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(37, 99, 235, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .user-info:active::after {
            width: 200px;
            height: 200px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: rgba(59, 130, 246, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: var(--primary-color);
            font-weight: 600;
        }

        .user-email {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .logout-btn {
            padding: 10px 18px;
            background: var(--glass-bg-light);
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 2px 4px var(--shadow-color);
            position: relative;
            overflow: hidden;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(239, 68, 68, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .logout-btn:active::after {
            width: 200px;
            height: 200px;
        }

        .logout-btn:hover {
            background: var(--hover-bg);
        }

        .logout-btn:active {
            background: var(--glass-bg-light);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: var(--header-height);
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(3px);
            background: var(--glass-bg);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            overflow-x: hidden;
            transition: all 0.3s ease;
            z-index: 999;
            box-shadow: 2px 0 8px var(--shadow-color);
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }

        .nav-section {
            padding: 20px 16px;
        }

        .nav-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.6px;
            padding: 0 12px 12px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 6px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 12px 14px;
            color: var(--text-primary);
            text-decoration: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(37, 99, 235, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .nav-link:active::after {
            width: 300px;
            height: 300px;
        }

        .nav-link i {
            width: 20px;
            text-align: center;
            font-size: 17px;
        }

        .nav-link:hover {
            background: var(--hover-bg);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6), 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .nav-link.active {
            background: var(--hover-bg);
            color: var(--primary-color);
            font-weight: 600;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6), 0 2px 4px var(--shadow-color);
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 28px;
            min-height: calc(100vh - var(--header-height));
            position: relative;
            z-index: 1;
        }

        .page-title {
            font-size: 30px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 28px;
            letter-spacing: -0.6px;
        }

        /* Section Cards */
        .section {
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(3px);
            background: var(--glass-bg);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: inset 2px 2px 1px 0 rgba(255, 255, 255, 0.7),
                        inset -1px -1px 1px 1px rgba(255, 255, 255, 0.7),
                        0 6px 6px rgba(0, 0, 0, 0.2), 
                        0 0 20px var(--shadow-color);
            transition: all 0.3s ease;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 19px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: -0.3px;
        }

        /* Ripple Effect */
        .ripple {
            position: relative;
            overflow: hidden;
        }

        .ripple::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .ripple:active::after {
            width: 300px;
            height: 300px;
        }

        /* Buttons */
        .btn {
            padding: 11px 20px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .btn:active::after {
            width: 200px;
            height: 200px;
        }

        .btn-primary {
            background: rgba(255, 255, 255, 0.35);
            color: var(--text-primary);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-primary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.45);
        }

        .btn-primary:active:not(:disabled) {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background: rgba(0, 0, 0, 0.05);
            color: var(--text-primary);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.3), 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(0, 0, 0, 0.08);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.15);
            color: #dc2626;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 2px 4px rgba(239, 68, 68, 0.1);
        }

        .btn-danger:hover:not(:disabled) {
            background: rgba(239, 68, 68, 0.25);
        }

        .btn-success {
            background: rgba(52, 211, 153, 0.15);
            color: #047857;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 2px 4px rgba(52, 211, 153, 0.1);
        }

        .btn-sm {
            padding: 7px 14px;
            font-size: 13px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Modern Checkbox with Success Icon */
        .checkbox-container {
            position: relative;
            display: inline-block;
        }

        input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 8px;
            background: var(--glass-bg-light);
            border: 2px solid var(--border-color);
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.3), 0 2px 4px var(--shadow-color);
        }

        input[type="checkbox"]:hover {
            background: var(--hover-bg);
            border-color: rgba(52, 211, 153, 0.3);
        }

        input[type="checkbox"]:checked {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        input[type="checkbox"]:checked::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(1);
            color: #fff;
            font-size: 12px;
            animation: checkPop 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes checkPop {
            0% {
                transform: translate(-50%, -50%) scale(0);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        input[type="checkbox"]:active {
            transform: scale(0.95);
        }

        /* Form Controls */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 13px;
        }

        .form-control {
            width: 100%;
            padding: 12px 14px;
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .form-control::placeholder {
            color: rgba(0, 0, 0, 0.4);
        }

        .form-control:focus {
            outline: none;
            border-color: rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.4);
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        thead {
            background: rgba(0, 0, 0, 0.05);
        }

        th {
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 13px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        td {
            padding: 14px 16px;
            color: var(--text-primary);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 5px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(52, 211, 153, 0.2);
            color: #047857;
        }

        .badge-warning {
            background: rgba(251, 191, 36, 0.2);
            color: #d97706;
        }

        .badge-error {
            background: rgba(239, 68, 68, 0.2);
            color: #dc2626;
        }

        .badge-info {
            background: rgba(59, 130, 246, 0.2);
            color: #2563eb;
        }

        /* Admin Role Badges */
        .admin-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.5px;
            background: rgba(59, 130, 246, 0.2);
            color: #2563eb;
            border: 1.5px solid rgba(59, 130, 246, 0.4);
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
        }

        .admin-badge i {
            font-size: 10px;
        }

        .owner-badge {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.25), rgba(245, 158, 11, 0.25));
            color: #d97706;
            border: 1.5px solid rgba(251, 191, 36, 0.5);
            box-shadow: 0 2px 4px rgba(251, 191, 36, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 28px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(3px);
            padding: 20px;
            border-radius: 16px;
            box-shadow: inset 2px 2px 1px 0 rgba(255, 255, 255, 0.7),
                        inset -1px -1px 1px 1px rgba(255, 255, 255, 0.7),
                        0 6px 6px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .stat-details {
            flex: 1;
        }

        .stat-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .stat-change {
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-change.positive {
            color: #047857;
        }

        .stat-change.negative {
            color: #dc2626;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            backdrop-filter: blur(2px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 19px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            color: var(--text-primary);
        }

        .modal-close:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Liquid Glass Popup */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            to { opacity: 0; }
        }

        @keyframes popupSlideIn {
            from {
                transform: scale(0.8) translateY(-20px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        @keyframes popupSlideOut {
            from {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
            to {
                transform: scale(0.8) translateY(-20px);
                opacity: 0;
            }
        }

        .popup-container {
            position: relative;
            max-width: 420px;
            width: calc(100% - 40px);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 60px rgba(0, 0, 0, 0.2);
            animation: popupSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .popup-overlay.fade-out {
            animation: fadeOut 0.3s ease forwards;
        }

        .popup-overlay.fade-out .popup-container {
            animation: popupSlideOut 0.3s ease forwards;
        }

        .liquidGlass-effect {
            position: absolute;
            z-index: 0;
            inset: 0;
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(3px);
            filter: url(#glass-distortion);
            overflow: hidden;
            isolation: isolate;
        }

        .liquidGlass-tint {
            z-index: 1;
            position: absolute;
            inset: 0;
            background: var(--glass-bg);
        }

        .liquidGlass-shine {
            position: absolute;
            inset: 0;
            z-index: 2;
            overflow: hidden;
            box-shadow: inset 2px 2px 1px 0 rgba(255, 255, 255, 0.7),
                        inset -1px -1px 1px 1px rgba(255, 255, 255, 0.7);
        }

        .popup-content {
            position: relative;
            z-index: 3;
            padding: 32px;
            text-align: center;
        }

        .popup-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .popup-icon.success {
            background: rgba(52, 211, 153, 0.25);
            color: #059669;
        }

        .popup-icon.error {
            background: rgba(239, 68, 68, 0.25);
            color: #dc2626;
        }

        .popup-icon.info {
            background: rgba(59, 130, 246, 0.25);
            color: #2563eb;
        }

        .popup-icon.warning {
            background: rgba(245, 158, 11, 0.25);
            color: #d97706;
        }

        .popup-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
            letter-spacing: -0.4px;
        }

        .popup-message {
            font-size: 15px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 28px;
        }

        .popup-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .popup-btn {
            padding: 12px 28px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .popup-btn-primary {
            background: rgba(59, 130, 246, 0.3);
            color: #1e40af;
        }

        .popup-btn-primary:hover {
            background: rgba(59, 130, 246, 0.4);
        }

        .popup-btn-secondary {
            background: var(--glass-bg-light);
            color: var(--text-primary);
        }

        .popup-btn-secondary:hover {
            background: var(--hover-bg);
        }

        .popup-btn:active {
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        /* Background Gallery Popup */
        .bg-gallery-container {
            max-width: 700px;
            width: calc(100% - 40px);
        }

        .bg-gallery-content {
            position: relative;
            z-index: 3;
            padding: 28px;
        }

        .bg-gallery-header {
            text-align: center;
            margin-bottom: 24px;
            position: relative;
        }

        .bg-gallery-icon {
            width: 56px;
            height: 56px;
            margin: 0 auto 16px;
            background: rgba(59, 130, 246, 0.25);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: #2563eb;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .bg-gallery-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            letter-spacing: -0.4px;
        }

        .bg-gallery-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .bg-gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
            max-height: 400px;
            overflow-y: auto;
            padding: 4px;
        }

        .bg-gallery-grid::-webkit-scrollbar {
            width: 8px;
        }

        .bg-gallery-grid::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
        }

        .bg-gallery-grid::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .bg-gallery-grid::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        .bg-gallery-item {
            position: relative;
            aspect-ratio: 16/10;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .bg-gallery-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
        }

        .bg-gallery-item.active {
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3), 0 6px 16px rgba(0, 0, 0, 0.25);
        }

        .bg-gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .bg-gallery-item-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .bg-gallery-item:hover .bg-gallery-item-overlay {
            opacity: 1;
        }

        .bg-gallery-item.active .bg-gallery-item-overlay {
            opacity: 1;
            background: rgba(37, 99, 235, 0.3);
        }

        .bg-gallery-item-check {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #2563eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .bg-gallery-item-label {
            position: absolute;
            bottom: 8px;
            left: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            color: #fff;
            font-size: 12px;
            font-weight: 600;
            padding: 6px 10px;
            border-radius: 6px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bg-gallery-loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .bg-gallery-loading i {
            font-size: 32px;
            margin-bottom: 12px;
            display: block;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Font Customization Popup */
        .font-custom-container {
            max-width: 450px;
            width: calc(100% - 40px);
        }

        .font-custom-content {
            position: relative;
            z-index: 3;
            padding: 20px;
        }

        .font-custom-header {
            text-align: center;
            margin-bottom: 18px;
            position: relative;
        }

        .popup-close-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 36px;
            height: 36px;
            background: rgba(239, 68, 68, 0.2);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #dc2626;
            transition: all 0.2s ease;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.3), 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .popup-close-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: scale(1.1);
        }

        /* 2D Color Picker */
        .color-picker-2d-wrapper {
            margin-bottom: 12px;
        }

        .color-picker-2d {
            width: 100%;
            height: 180px;
            border-radius: 12px;
            position: relative;
            cursor: crosshair;
            background: linear-gradient(to right, #fff, #f00);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2), 0 2px 8px var(--shadow-color);
            border: 2px solid var(--border-color);
            overflow: hidden;
        }

        .color-picker-2d::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0), #000);
        }

        .color-picker-2d-cursor {
            position: absolute;
            width: 16px;
            height: 16px;
            border: 3px solid #fff;
            border-radius: 50%;
            box-shadow: 0 0 0 1px rgba(0,0,0,0.3), 0 2px 8px rgba(0,0,0,0.4);
            transform: translate(-50%, -50%);
            pointer-events: none;
            transition: none;
        }

        .color-hue-slider {
            width: 100%;
            height: 24px;
            border-radius: 12px;
            background: linear-gradient(to right, 
                #ff0000 0%, 
                #ffff00 17%, 
                #00ff00 33%, 
                #00ffff 50%, 
                #0000ff 67%, 
                #ff00ff 83%, 
                #ff0000 100%
            );
            position: relative;
            cursor: pointer;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2), 0 2px 8px var(--shadow-color);
            border: 2px solid var(--border-color);
            margin-bottom: 12px;
        }

        .color-hue-cursor {
            position: absolute;
            width: 20px;
            height: 28px;
            background: #fff;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            top: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            pointer-events: none;
        }

        .color-result-display {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--glass-bg-light);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            margin-bottom: 12px;
        }

        .color-result-swatch {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid var(--border-color);
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.3), 0 2px 4px var(--shadow-color);
        }

        .color-result-hex {
            flex: 1;
            background: transparent;
            border: none;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
        }

        .color-result-hex:focus {
            outline: none;
        }

        .popup-close-btn:active {
            transform: scale(0.95);
        }

        .font-custom-icon {
            width: 56px;
            height: 56px;
            margin: 0 auto 16px;
            background: rgba(139, 92, 246, 0.25);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: #7c3aed;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .font-custom-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            letter-spacing: -0.4px;
        }

        .font-custom-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .font-custom-section {
            margin-bottom: 24px;
        }

        .font-custom-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .font-custom-label i {
            color: var(--primary-color);
            font-size: 12px;
        }

        .font-select-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .font-option {
            padding: 10px 8px;
            background: var(--glass-bg-light);
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .font-option:hover {
            background: var(--hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .font-option.active {
            border-color: #7c3aed;
            background: rgba(139, 92, 246, 0.15);
            color: #7c3aed;
            font-weight: 600;
            box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.2), 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .font-weight-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .weight-option {
            padding: 10px;
            background: var(--glass-bg-light);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .weight-option:hover {
            background: var(--hover-bg);
            transform: scale(1.05);
        }

        .weight-option.active {
            border-color: #7c3aed;
            background: rgba(139, 92, 246, 0.15);
            color: #7c3aed;
            font-weight: 600;
        }

        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .color-picker-input {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            background: var(--glass-bg-light);
            border-radius: 10px;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.5), 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .color-picker-swatch {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            cursor: pointer;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .color-picker-swatch:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .color-picker-hex {
            flex: 1;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
        }

        .color-picker-hex:focus {
            outline: none;
            border-color: #7c3aed;
            background: rgba(255, 255, 255, 0.4);
        }

        .color-preset-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .color-preset {
            aspect-ratio: 1;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .color-preset:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .color-preset.active {
            border-color: #fff;
            box-shadow: 0 0 0 2px #7c3aed, 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .font-preview-box {
            padding: 16px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            margin-bottom: 16px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .font-preview-text {
            font-size: 16px;
            line-height: 1.5;
            text-align: center;
            transition: all 0.3s ease;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .header-left .menu-btn {
                display: flex;
            }

            .header-left .sidebar-toggle-btn {
                display: none;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (min-width: 769px) {
            .header-left .menu-btn {
                display: none;
            }
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mt-1 { margin-top: 8px; }
        .mt-2 { margin-top: 16px; }
        .mt-3 { margin-top: 24px; }
        .mb-1 { margin-bottom: 8px; }
        .mb-2 { margin-bottom: 16px; }
        .mb-3 { margin-bottom: 24px; }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <button class="sidebar-toggle-btn" onclick="toggleSidebarDesktop()" title="ng/M Sidebar">
                    <i class="fas fa-bars"></i>
                </button>
                <button class="menu-btn" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <a href="/admin/dashboard" class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-shield-halved"></i>
                    </div>
                    <span>Muakey.cloud</span>
                </a>
            </div>
            
            <div class="header-right">
                <button class="font-customize-btn" onclick="openFontCustomization()">
                    <i class="fas fa-font"></i>
                    <span>Font</span>
                </button>
                <button class="bg-customize-btn" onclick="openBackgroundGallery()">
                    <i class="fas fa-image"></i>
                    <span>Background</span>
                </button>
                <button class="theme-toggle ripple" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="theme-icon"></i>
                    <span id="theme-text">Dark</span>
                </button>
                <a href="/admin/dashboard/user-settings" class="user-info ripple" style="text-decoration: none; cursor: pointer;">
                    <div class="user-avatar" id="userAvatarDisplay">
                        <i class="fas fa-user"></i>
                    </div>
                    <span class="user-email" id="userDisplayName">{{ admin_email }}</span>
                </a>
                <a href="/admin/logout" class="logout-btn ripple">
                    <i class="fas fa-right-from-bracket"></i>
                    <span>ng Xut</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
        <nav class="nav-section">
            <div class="nav-section-title">Qun L</div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/admin/dashboard/home" class="nav-link {{ 'active' if request.endpoint == 'admin_dashboard_home' else '' }}">
                        <i class="fas fa-house"></i>
                        <span>Tng Quan</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/dashboard/keys" class="nav-link {{ 'active' if request.endpoint == 'admin_dashboard_keys' else '' }}">
                        <i class="fas fa-key"></i>
                        <span>Qun L Keys</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/dashboard/orders" class="nav-link {{ 'active' if request.endpoint == 'admin_dashboard_orders' else '' }}">
                        <i class="fas fa-shopping-cart"></i>
                        <span>n Hng</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/dashboard/prices" class="nav-link {{ 'active' if request.endpoint == 'admin_dashboard_prices' else '' }}">
                        <i class="fas fa-tag"></i>
                        <span>Qun L Gi</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/dashboard/coupons" class="nav-link {{ 'active' if request.endpoint == 'admin_dashboard_coupons' else '' }}">
                        <i class="fas fa-ticket"></i>
                        <span>M Gim Gi</span>
                    </a>
                </li>
            </ul>
        </nav>

        <nav class="nav-section">
            <div class="nav-section-title">H Thng</div>
            <ul class="nav-menu">
                {% if is_owner %}
                <li class="nav-item">
                    <a href="/admin/dashboard/admins" class="nav-link {{ 'active' if request.endpoint == 'admin_dashboard_admins' else '' }}">
                        <i class="fas fa-users-cog"></i>
                        <span>Qun L Admin</span>
                    </a>
                </li>
                {% endif %}
                <li class="nav-item">
                    <a href="/admin/dashboard/settings" class="nav-link {{ 'active' if request.endpoint == 'admin_dashboard_settings' else '' }}">
                        <i class="fas fa-gear"></i>
                        <span>Ci t</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/dashboard/analytics" class="nav-link {{ 'active' if request.endpoint == 'admin_dashboard_analytics' else '' }}">
                        <i class="fas fa-chart-line"></i>
                        <span>Thng K</span>
                    </a>
                </li>
            </ul>
        </nav>

        <nav class="nav-section" style="margin-top: auto; padding-bottom: 20px;">
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/admin/dashboard/user-settings" class="nav-link {{ 'active' if request.endpoint == 'admin_dashboard_user_settings' else '' }}">
                        <i class="fas fa-user-circle"></i>
                        <span>Thng Tin C Nhn</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        {% block content %}{% endblock %}
    </div>

    <!-- SVG Filters -->
    <svg style="display: none">
        <filter id="glass-distortion" x="0%" y="0%" width="100%" height="100%" filterUnits="objectBoundingBox">
            <feTurbulence type="fractalNoise" baseFrequency="0.01 0.01" numOctaves="1" seed="5" result="turbulence"/>
            <feComponentTransfer in="turbulence" result="mapped">
                <feFuncR type="gamma" amplitude="1" exponent="10" offset="0.5"/>
                <feFuncG type="gamma" amplitude="0" exponent="1" offset="0"/>
                <feFuncB type="gamma" amplitude="0" exponent="1" offset="0.5"/>
            </feComponentTransfer>
            <feGaussianBlur in="turbulence" stdDeviation="3" result="softMap"/>
            <feSpecularLighting in="softMap" surfaceScale="5" specularConstant="1" specularExponent="100" lighting-color="white" result="specLight">
                <fePointLight x="-200" y="-200" z="300"/>
            </feSpecularLighting>
            <feComposite in="specLight" operator="arithmetic" k1="0" k2="1" k3="1" k4="0" result="litImage"/>
            <feDisplacementMap in="SourceGraphic" in2="softMap" scale="150" xChannelSelector="R" yChannelSelector="G"/>
        </filter>
    </svg>

    <!-- Common JavaScript -->
    <script>
        // Liquid Glass Popup Functions
        function showPopup(options) {
            const {
                title = '',
                message = '',
                type = 'info', // success, error, info, warning
                buttons = [{ text: 'OK', primary: true }],
                autoClose = 0 // 0 = manual close, >0 = auto close in ms
            } = options;

            // Remove existing popup if any
            const existingPopup = document.querySelector('.popup-overlay');
            if (existingPopup) {
                existingPopup.remove();
            }

            const icons = {
                success: 'fa-check-circle',
                error: 'fa-times-circle',
                info: 'fa-info-circle',
                warning: 'fa-exclamation-triangle'
            };

            const titles = {
                success: 'Thnh Cng!',
                error: 'Li!',
                info: 'Thng Bo',
                warning: 'Cnh Bo!'
            };

            // Create popup overlay
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';
            
            // Create popup HTML
            overlay.innerHTML = `
                <div class="popup-container">
                    <div class="liquidGlass-effect"></div>
                    <div class="liquidGlass-tint"></div>
                    <div class="liquidGlass-shine"></div>
                    <div class="popup-content">
                        <div class="popup-icon ${type}">
                            <i class="fas ${icons[type]}"></i>
                        </div>
                        <h3 class="popup-title">${title || titles[type]}</h3>
                        <p class="popup-message">${message}</p>
                        <div class="popup-buttons">
                            ${buttons.map((btn, index) => `
                                <button class="popup-btn ${btn.primary ? 'popup-btn-primary' : 'popup-btn-secondary'}" 
                                        onclick="closePopup(${btn.callback ? `'${btn.callback}'` : 'null'})">
                                    ${btn.text}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(overlay);

            // Auto close if specified
            if (autoClose > 0) {
                setTimeout(() => {
                    closePopup();
                }, autoClose);
            }

            return overlay;
        }

        function closePopup(callback) {
            const overlay = document.querySelector('.popup-overlay');
            if (overlay) {
                overlay.classList.add('fade-out');
                setTimeout(() => {
                    overlay.remove();
                    if (callback && typeof window[callback] === 'function') {
                        window[callback]();
                    }
                }, 300);
            }
        }

        // Legacy compatibility functions
        function showAlert(elementId, message, type) {
            showPopup({
                message: message,
                type: type,
                autoClose: type === 'success' ? 3000 : 0
            });
        }

        function showNotification(message, type) {
            showPopup({
                message: message,
                type: type,
                autoClose: 3000
            });
        }

        // Confirm dialog
        function showConfirm(message, onConfirm, onCancel) {
            showPopup({
                message: message,
                type: 'warning',
                buttons: [
                    { text: 'Hy', primary: false, callback: onCancel },
                    { text: 'Xc Nhn', primary: true, callback: onConfirm }
                ]
            });
        }

        // Theme Management
        const themes = ['light', 'dark', 'mixed'];
        let currentThemeIndex = 0;

        function initTheme() {
            const savedTheme = localStorage.getItem('dashboard-theme') || 'light';
            currentThemeIndex = themes.indexOf(savedTheme);
            if (currentThemeIndex === -1) currentThemeIndex = 0;
            applyTheme(themes[currentThemeIndex]);
        }

        function toggleTheme() {
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            const newTheme = themes[currentThemeIndex];
            applyTheme(newTheme);
            localStorage.setItem('dashboard-theme', newTheme);
        }

        function applyTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');
            
            if (theme === 'light') {
                themeIcon.className = 'fas fa-moon';
                themeText.textContent = 'Dark';
            } else if (theme === 'dark') {
                themeIcon.className = 'fas fa-adjust';
                themeText.textContent = 'Mixed';
            } else if (theme === 'mixed') {
                themeIcon.className = 'fas fa-sun';
                themeText.textContent = 'Light';
            }
        }

        // Initialize theme on page load
        initTheme();

        // Load and update user settings in header
        function loadUserSettings() {
            const avatarUrl = localStorage.getItem('user-avatar');
            const displayName = localStorage.getItem('user-display-name');
            
            const avatarDisplay = document.getElementById('userAvatarDisplay');
            const nameDisplay = document.getElementById('userDisplayName');
            
            if (avatarDisplay && avatarUrl) {
                avatarDisplay.innerHTML = `<img src="${avatarUrl}" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;" onerror="this.parentElement.innerHTML='<i class=\\'fas fa-user\\'></i>'">`;
            }
            
            if (nameDisplay && displayName) {
                nameDisplay.textContent = displayName;
            }
        }

        // Initialize user settings on page load
        loadUserSettings();

        // Sidebar Toggle Function
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('active');
        }

        // Desktop Sidebar Toggle
        function toggleSidebarDesktop() {
            document.body.classList.toggle('sidebar-collapsed');
            localStorage.setItem('sidebar-collapsed', document.body.classList.contains('sidebar-collapsed'));
        }

        // Restore sidebar state
        if (localStorage.getItem('sidebar-collapsed') === 'true') {
            document.body.classList.add('sidebar-collapsed');
        }

        // Background Gallery Management
        let backgroundImages = [];
        let currentBackground = localStorage.getItem('dashboard-background') || 'https://www.publicdomainpictures.net/pictures/610000/velka/seamless-floral-wallpaper-art-1715193626Gct.jpg';

        function openBackgroundGallery() {
            // Create popup overlay
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';
            
            overlay.innerHTML = `
                <div class="popup-container bg-gallery-container">
                    <div class="liquidGlass-effect"></div>
                    <div class="liquidGlass-tint"></div>
                    <div class="liquidGlass-shine"></div>
                    <div class="bg-gallery-content">
                        <div class="bg-gallery-header">
                            <button class="popup-close-btn" onclick="closePopup()">
                                <i class="fas fa-times"></i>
                            </button>
                            <div class="bg-gallery-icon">
                                <i class="fas fa-images"></i>
                            </div>
                            <h3 class="bg-gallery-title">Ty Chnh Background</h3>
                            <p class="bg-gallery-subtitle">Chn hnh nn cho dashboard ca bn</p>
                        </div>
                        <div id="bgGalleryGrid" class="bg-gallery-loading">
                            <i class="fas fa-spinner"></i>
                            <p>ang ti hnh nh...</p>
                        </div>
                        <div class="popup-buttons">
                            <button class="popup-btn popup-btn-secondary" onclick="closePopup()">
                                ng
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(overlay);
            
            // Load background images
            loadBackgroundImages();
        }

        async function loadBackgroundImages() {
            try {
                const response = await fetch('/admin/api/background-images');
                const data = await response.json();
                
                if (data.success && data.images) {
                    backgroundImages = data.images;
                    renderBackgroundGallery();
                } else {
                    document.getElementById('bgGalleryGrid').innerHTML = `
                        <div style="text-align: center; color: var(--text-secondary);">
                            <i class="fas fa-exclamation-circle" style="font-size: 32px; margin-bottom: 12px; display: block;"></i>
                            <p>Khng th ti danh sch hnh nn</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading backgrounds:', error);
                document.getElementById('bgGalleryGrid').innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary);">
                        <i class="fas fa-times-circle" style="font-size: 32px; margin-bottom: 12px; display: block;"></i>
                        <p>Li kt ni. Vui lng th li.</p>
                    </div>
                `;
            }
        }

        function renderBackgroundGallery() {
            const grid = document.getElementById('bgGalleryGrid');
            grid.className = 'bg-gallery-grid';
            
            if (backgroundImages.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-image" style="font-size: 32px; margin-bottom: 12px; display: block; opacity: 0.5;"></i>
                        <p>Cha c hnh nn no</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = backgroundImages.map((img, index) => {
                const isActive = img.url === currentBackground;
                return `
                    <div class="bg-gallery-item ${isActive ? 'active' : ''}" onclick="selectBackground('${img.url}', ${index})">
                        <img src="${img.url}" alt="${img.name}" loading="lazy">
                        <div class="bg-gallery-item-overlay">
                            ${isActive ? '<div class="bg-gallery-item-check"><i class="fas fa-check"></i></div>' : ''}
                        </div>
                        <div class="bg-gallery-item-label">${img.name}</div>
                    </div>
                `;
            }).join('');
        }

        function selectBackground(url, index) {
            // Update current background
            currentBackground = url;
            localStorage.setItem('dashboard-background', url);
            
            // Apply background
            document.body.style.backgroundImage = `url('${url}')`;
            
            // Update active state in gallery
            document.querySelectorAll('.bg-gallery-item').forEach((item, i) => {
                if (i === index) {
                    item.classList.add('active');
                    item.querySelector('.bg-gallery-item-overlay').innerHTML = '<div class="bg-gallery-item-check"><i class="fas fa-check"></i></div>';
                } else {
                    item.classList.remove('active');
                    item.querySelector('.bg-gallery-item-overlay').innerHTML = '';
                }
            });
            
            // Show success notification
            showPopup({
                message: ' thay i background thnh cng!',
                type: 'success',
                autoClose: 2000
            });
        }

        // Apply saved background on page load
        function initBackground() {
            const savedBg = localStorage.getItem('dashboard-background');
            if (savedBg) {
                document.body.style.backgroundImage = `url('${savedBg}')`;
                currentBackground = savedBg;
            }
        }

        // Initialize background
        initBackground();

        // Font Customization Management
        const availableFonts = [
            { name: 'Inter', family: 'Inter, sans-serif' },
            { name: 'Be Vietnam Pro', family: '"Be Vietnam Pro", sans-serif' },
            { name: 'Lexend', family: 'Lexend, sans-serif' },
            { name: 'Nunito', family: 'Nunito, sans-serif' },
            { name: 'Quicksand', family: 'Quicksand, sans-serif' },
            { name: 'Comfortaa', family: 'Comfortaa, sans-serif' },
            { name: 'Poppins', family: 'Poppins, sans-serif' },
            { name: 'Montserrat', family: 'Montserrat, sans-serif' }
        ];

        const fontWeights = [
            { label: 'Light', value: '300' },
            { label: 'Normal', value: '400' },
            { label: 'Medium', value: '500' },
            { label: 'SemiBold', value: '600' },
            { label: 'Bold', value: '700' },
            { label: 'ExtraBold', value: '800' }
        ];

        const colorPresets = [
            '#000000', '#333333', '#666666', '#999999',
            '#2563eb', '#7c3aed', '#dc2626', '#ea580c',
            '#16a34a', '#0891b2', '#db2777', '#9333ea',
            '#ca8a04', '#65a30d', '#0d9488', '#4f46e5'
        ];

        let currentFont = localStorage.getItem('dashboard-font') || 'Inter, sans-serif';
        let currentWeight = localStorage.getItem('dashboard-font-weight') || '400';
        let currentColor = localStorage.getItem('dashboard-font-color') || '#000000';

        function openFontCustomization() {
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';
            
            overlay.innerHTML = `
                <div class="popup-container font-custom-container">
                    <div class="liquidGlass-effect"></div>
                    <div class="liquidGlass-tint"></div>
                    <div class="liquidGlass-shine"></div>
                    <div class="font-custom-content">
                        <div class="font-custom-header">
                            <button class="popup-close-btn" onclick="closePopup()">
                                <i class="fas fa-times"></i>
                            </button>
                            <div class="font-custom-icon">
                                <i class="fas fa-text-height"></i>
                            </div>
                            <h3 class="font-custom-title">Ty Chnh Font Ch</h3>
                            <p class="font-custom-subtitle">C nhn ha giao din ca bn</p>
                        </div>

                        <div class="font-preview-box">
                            <div class="font-preview-text" id="fontPreview" style="font-family: ${currentFont}; font-weight: ${currentWeight}; color: ${currentColor};">
                                Xin cho! Dashboard qun tr Vit Nam 2026 <br>
                                <span style="font-size: 14px; opacity: 0.7;">The quick brown fox jumps over the lazy dog</span>
                            </div>
                        </div>

                        <div class="font-custom-section">
                            <label class="font-custom-label">
                                <i class="fas fa-font"></i>
                                Chn Font Ch
                            </label>
                            <div class="font-select-grid" id="fontGrid"></div>
                        </div>

                        <div class="font-custom-section">
                            <label class="font-custom-label">
                                <i class="fas fa-bold"></i>
                                 m
                            </label>
                            <div class="font-weight-grid" id="weightGrid"></div>
                        </div>

                        <div class="font-custom-section">
                            <label class="font-custom-label">
                                <i class="fas fa-palette"></i>
                                Mu Ch
                            </label>
                            <div class="color-picker-2d-wrapper">
                                <div class="color-picker-2d" id="colorPicker2D">
                                    <div class="color-picker-2d-cursor" id="colorCursor"></div>
                                </div>
                            </div>
                            <div class="color-hue-slider" id="hueSlider">
                                <div class="color-hue-cursor" id="hueCursor"></div>
                            </div>
                            <div class="color-result-display">
                                <div class="color-result-swatch" id="colorResultSwatch" style="background-color: ${currentColor};"></div>
                                <input type="text" class="color-result-hex" id="colorHexInput" value="${currentColor}" maxlength="7" oninput="updateColorFromHex2D(this.value)">
                            </div>
                        </div>

                        <div class="popup-buttons">
                            <button class="popup-btn popup-btn-secondary" onclick="resetFontSettings()">
                                <i class="fas fa-undo"></i> t Li
                            </button>
                            <button class="popup-btn popup-btn-primary" onclick="applyFontSettings()">
                                <i class="fas fa-check"></i> p Dng
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(overlay);
            renderFontOptions();
            renderWeightOptions();
            initColorPicker2D();
        }

        function renderFontOptions() {
            const grid = document.getElementById('fontGrid');
            grid.innerHTML = availableFonts.map(font => {
                const isActive = currentFont === font.family;
                return `
                    <div class="font-option ${isActive ? 'active' : ''}" 
                         style="font-family: ${font.family};" 
                         onclick="selectFont('${font.family}')">
                        ${font.name}
                    </div>
                `;
            }).join('');
        }

        function renderWeightOptions() {
            const grid = document.getElementById('weightGrid');
            grid.innerHTML = fontWeights.map(weight => {
                const isActive = currentWeight === weight.value;
                return `
                    <div class="weight-option ${isActive ? 'active' : ''}" 
                         style="font-weight: ${weight.value};" 
                         onclick="selectWeight('${weight.value}')">
                        ${weight.label}
                    </div>
                `;
            }).join('');
        }

        function selectFont(family) {
            currentFont = family;
            document.querySelectorAll('.font-option').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            updatePreview();
        }

        function selectWeight(weight) {
            currentWeight = weight;
            document.querySelectorAll('.weight-option').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            updatePreview();
        }

        // 2D Color Picker Logic
        let currentHue = 0;
        let currentSaturation = 100;
        let currentLightness = 50;
        let picker2D, hueSlider, colorCursor, hueCursor;

        function initColorPicker2D() {
            picker2D = document.getElementById('colorPicker2D');
            hueSlider = document.getElementById('hueSlider');
            colorCursor = document.getElementById('colorCursor');
            hueCursor = document.getElementById('hueCursor');

            if (!picker2D || !hueSlider) return;

            // Convert current color to HSL
            const rgb = hexToRgb(currentColor);
            const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
            currentHue = hsl.h;
            currentSaturation = hsl.s;
            currentLightness = hsl.l;

            updatePickerBackground();
            updateCursorPositions();

            // 2D Picker Mouse Events
            let isDragging2D = false;
            picker2D.addEventListener('mousedown', (e) => {
                isDragging2D = true;
                updateColorFrom2D(e);
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging2D) {
                    updateColorFrom2D(e);
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging2D = false;
            });

            // Hue Slider Mouse Events
            let isDraggingHue = false;
            hueSlider.addEventListener('mousedown', (e) => {
                isDraggingHue = true;
                updateHue(e);
            });

            document.addEventListener('mousemove', (e) => {
                if (isDraggingHue) {
                    updateHue(e);
                }
            });

            document.addEventListener('mouseup', () => {
                isDraggingHue = false;
            });

            function updateColorFrom2D(e) {
                const rect = picker2D.getBoundingClientRect();
                const x = Math.max(0, Math.min(e.clientX - rect.left, rect.width));
                const y = Math.max(0, Math.min(e.clientY - rect.top, rect.height));

                currentSaturation = (x / rect.width) * 100;
                currentLightness = 100 - (y / rect.height) * 100;

                updateColorFromHSL();
                updateCursorPositions();
            }

            function updateHue(e) {
                const rect = hueSlider.getBoundingClientRect();
                const x = Math.max(0, Math.min(e.clientX - rect.left, rect.width));
                currentHue = (x / rect.width) * 360;

                updatePickerBackground();
                updateColorFromHSL();
                updateCursorPositions();
            }

            function updateColorFromHSL() {
                const rgb = hslToRgb(currentHue, currentSaturation, currentLightness);
                currentColor = rgbToHexConvert(rgb.r, rgb.g, rgb.b);
                
                document.getElementById('colorResultSwatch').style.backgroundColor = currentColor;
                document.getElementById('colorHexInput').value = currentColor.toUpperCase();
                updatePreview();
            }
        }

        function updatePickerBackground() {
            if (!picker2D) return;
            const hueColor = hslToRgb(currentHue, 100, 50);
            const hueHex = rgbToHexConvert(hueColor.r, hueColor.g, hueColor.b);
            picker2D.style.background = `linear-gradient(to right, #fff, ${hueHex})`;
        }

        function updateCursorPositions() {
            if (!picker2D || !hueSlider || !colorCursor || !hueCursor) return;
            
            const picker2DRect = picker2D.getBoundingClientRect();
            const x = (currentSaturation / 100) * picker2DRect.width;
            const y = ((100 - currentLightness) / 100) * picker2DRect.height;
            
            colorCursor.style.left = x + 'px';
            colorCursor.style.top = y + 'px';

            const hueSliderRect = hueSlider.getBoundingClientRect();
            const hueX = (currentHue / 360) * hueSliderRect.width;
            hueCursor.style.left = hueX + 'px';
        }

        function updateColorFromHex2D(hex) {
            if (/^#[0-9A-F]{6}$/i.test(hex)) {
                currentColor = hex;
                const rgb = hexToRgb(hex);
                const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
                currentHue = hsl.h;
                currentSaturation = hsl.s;
                currentLightness = hsl.l;

                updatePickerBackground();
                updateCursorPositions();

                if (document.getElementById('colorResultSwatch')) {
                    document.getElementById('colorResultSwatch').style.backgroundColor = hex;
                }
                updatePreview();
            }
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : { r: 0, g: 0, b: 0 };
        }

        function rgbToHsl(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;

            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);

                switch (max) {
                    case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
                    case g: h = ((b - r) / d + 2) / 6; break;
                    case b: h = ((r - g) / d + 4) / 6; break;
                }
            }

            return {
                h: h * 360,
                s: s * 100,
                l: l * 100
            };
        }

        function hslToRgb(h, s, l) {
            h /= 360;
            s /= 100;
            l /= 100;

            let r, g, b;

            if (s === 0) {
                r = g = b = l;
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };

                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;

                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }

            return {
                r: Math.round(r * 255),
                g: Math.round(g * 255),
                b: Math.round(b * 255)
            };
        }

        function rgbToHexConvert(r, g, b) {
            return '#' + [r, g, b].map(x => {
                const hex = x.toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            }).join('');
        }

        function updateColorPicker(color) {
            currentColor = color;
            updatePreview();
        }

        function updateColorFromHex(hex) {
            if (/^#[0-9A-F]{6}$/i.test(hex)) {
                currentColor = hex;
                document.getElementById('colorSwatch').style.backgroundColor = hex;
                document.getElementById('colorInput').value = hex;
                updatePreview();
                updateColorPresetActive();
            }
        }

        function selectPresetColor(color) {
            currentColor = color;
            document.getElementById('colorInput').value = color;
            document.getElementById('colorSwatch').style.backgroundColor = color;
            document.getElementById('colorHex').value = color.toUpperCase();
            updatePreview();
            updateColorPresetActive();
        }

        function updateColorPresetActive() {
            document.querySelectorAll('.color-preset').forEach(el => {
                const presetColor = el.style.backgroundColor;
                const hexColor = rgbToHex(presetColor);
                if (hexColor.toLowerCase() === currentColor.toLowerCase()) {
                    el.classList.add('active');
                } else {
                    el.classList.remove('active');
                }
            });
        }

        function rgbToHex(rgb) {
            const result = rgb.match(/\d+/g);
            if (!result) return rgb;
            return '#' + result.map(x => {
                const hex = parseInt(x).toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            }).join('');
        }

        function updatePreview() {
            const preview = document.getElementById('fontPreview');
            if (preview) {
                preview.style.fontFamily = currentFont;
                preview.style.fontWeight = currentWeight;
                preview.style.color = currentColor;
            }
        }

        function applyFontSettings() {
            // Save to localStorage
            localStorage.setItem('dashboard-font', currentFont);
            localStorage.setItem('dashboard-font-weight', currentWeight);
            localStorage.setItem('dashboard-font-color', currentColor);
            
            // Apply to body
            document.body.style.fontFamily = currentFont;
            document.body.style.fontWeight = currentWeight;
            document.body.style.setProperty('--text-primary', currentColor);
            
            closePopup();
            showPopup({
                message: ' p dng ci t font ch!',
                type: 'success',
                autoClose: 2000
            });
        }

        function resetFontSettings() {
            currentFont = 'Inter, sans-serif';
            currentWeight = '400';
            currentColor = '#000000';
            
            localStorage.removeItem('dashboard-font');
            localStorage.removeItem('dashboard-font-weight');
            localStorage.removeItem('dashboard-font-color');
            
            renderFontOptions();
            renderWeightOptions();
            document.getElementById('colorInput').value = currentColor;
            document.getElementById('colorSwatch').style.backgroundColor = currentColor;
            document.getElementById('colorHex').value = currentColor;
            updateColorPresetActive();
            updatePreview();
            
            showPopup({
                message: ' t li ci t mc nh!',
                type: 'info',
                autoClose: 2000
            });
        }

        // Apply saved font settings on page load
        function initFontSettings() {
            const savedFont = localStorage.getItem('dashboard-font');
            const savedWeight = localStorage.getItem('dashboard-font-weight');
            const savedColor = localStorage.getItem('dashboard-font-color');
            
            if (savedFont) {
                document.body.style.fontFamily = savedFont;
                currentFont = savedFont;
            }
            if (savedWeight) {
                document.body.style.fontWeight = savedWeight;
                currentWeight = savedWeight;
            }
            if (savedColor) {
                document.body.style.setProperty('--text-primary', savedColor);
                currentColor = savedColor;
            }
        }

        // Initialize font settings
        initFontSettings();

        // ========== GLOBAL NOTIFICATION SYSTEM ==========
        
        // Success Notification
        function showSuccessNotification(message) {
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';
            overlay.innerHTML = `
                <div class="popup-container" style="max-width: 420px;">
                    <div class="liquidGlass-effect"></div>
                    <div class="liquidGlass-tint"></div>
                    <div class="liquidGlass-shine"></div>
                    <div style="position: relative; z-index: 1; padding: 32px; text-align: center;">
                        <div style="width: 64px; height: 64px; margin: 0 auto 20px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3); animation: successPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);">
                            <i class="fas fa-check" style="font-size: 32px; color: #fff;"></i>
                        </div>
                        <h3 style="margin-bottom: 12px; font-size: 20px; color: var(--text-primary);">Thnh Cng!</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 24px;">${message}</p>
                        <button class="btn btn-primary ripple" onclick="closePopup()" style="width: 100%;">
                            <i class="fas fa-check"></i> OK
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);
            setTimeout(() => overlay.classList.add('active'), 10);
        }

        // Error Notification
        function showErrorNotification(message) {
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';
            overlay.innerHTML = `
                <div class="popup-container" style="max-width: 420px;">
                    <div class="liquidGlass-effect"></div>
                    <div class="liquidGlass-tint"></div>
                    <div class="liquidGlass-shine"></div>
                    <div style="position: relative; z-index: 1; padding: 32px; text-align: center;">
                        <div style="width: 64px; height: 64px; margin: 0 auto 20px; background: linear-gradient(135deg, #ef4444, #dc2626); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px rgba(239, 68, 68, 0.3); animation: errorShake 0.5s;">
                            <i class="fas fa-exclamation" style="font-size: 32px; color: #fff;"></i>
                        </div>
                        <h3 style="margin-bottom: 12px; font-size: 20px; color: var(--text-primary);">Li!</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 24px;">${message}</p>
                        <button class="btn btn-danger ripple" onclick="closePopup()" style="width: 100%;">
                            <i class="fas fa-times"></i> ng
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);
            setTimeout(() => overlay.classList.add('active'), 10);
        }

        // Info Notification
        function showInfoNotification(message) {
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';
            overlay.innerHTML = `
                <div class="popup-container" style="max-width: 420px;">
                    <div class="liquidGlass-effect"></div>
                    <div class="liquidGlass-tint"></div>
                    <div class="liquidGlass-shine"></div>
                    <div style="position: relative; z-index: 1; padding: 32px; text-align: center;">
                        <div style="width: 64px; height: 64px; margin: 0 auto 20px; background: linear-gradient(135deg, #3b82f6, #2563eb); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3); animation: successPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);">
                            <i class="fas fa-info" style="font-size: 32px; color: #fff;"></i>
                        </div>
                        <h3 style="margin-bottom: 12px; font-size: 20px; color: var(--text-primary);">Thng Bo</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 24px;">${message}</p>
                        <button class="btn btn-primary ripple" onclick="closePopup()" style="width: 100%;">
                            <i class="fas fa-check"></i> OK
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);
            setTimeout(() => overlay.classList.add('active'), 10);
        }

        // Confirm Dialog
        function showConfirmDialog(title, message, onConfirm) {
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';
            overlay.innerHTML = `
                <div class="popup-container" style="max-width: 480px;">
                    <div class="liquidGlass-effect"></div>
                    <div class="liquidGlass-tint"></div>
                    <div class="liquidGlass-shine"></div>
                    <div style="position: relative; z-index: 1; padding: 32px;">
                        <div style="text-align: center; margin-bottom: 24px;">
                            <div style="width: 64px; height: 64px; margin: 0 auto 20px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px rgba(245, 158, 11, 0.3);">
                                <i class="fas fa-question" style="font-size: 32px; color: #fff;"></i>
                            </div>
                            <h3 style="margin-bottom: 12px; font-size: 20px; color: var(--text-primary);">${title}</h3>
                            <p style="color: var(--text-secondary);">${message}</p>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <button class="btn btn-secondary ripple" onclick="closePopup()">
                                <i class="fas fa-times"></i> Hy
                            </button>
                            <button class="btn btn-primary ripple" onclick="closePopup(() => arguments[0]())">
                                <i class="fas fa-check"></i> Xc Nhn
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);
            setTimeout(() => overlay.classList.add('active'), 10);
            
            // Store callback
            overlay.querySelector('.btn-primary').onclick = () => {
                closePopup(() => onConfirm && onConfirm());
            };
        }

        // Input Dialog
        function showInputDialog(title, placeholder, onSubmit) {
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';
            overlay.innerHTML = `
                <div class="popup-container" style="max-width: 480px;">
                    <div class="liquidGlass-effect"></div>
                    <div class="liquidGlass-tint"></div>
                    <div class="liquidGlass-shine"></div>
                    <div style="position: relative; z-index: 1; padding: 32px;">
                        <div style="text-align: center; margin-bottom: 24px;">
                            <div style="width: 64px; height: 64px; margin: 0 auto 20px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px rgba(139, 92, 246, 0.3);">
                                <i class="fas fa-keyboard" style="font-size: 32px; color: #fff;"></i>
                            </div>
                            <h3 style="margin-bottom: 12px; font-size: 20px; color: var(--text-primary);">${title}</h3>
                        </div>
                        <input type="text" class="form-control" id="inputDialogValue" placeholder="${placeholder}" style="margin-bottom: 20px;" autofocus>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <button class="btn btn-secondary ripple" onclick="closePopup()">
                                <i class="fas fa-times"></i> Hy
                            </button>
                            <button class="btn btn-primary ripple" id="inputDialogSubmit">
                                <i class="fas fa-check"></i> OK
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);
            setTimeout(() => overlay.classList.add('active'), 10);
            
            const input = overlay.querySelector('#inputDialogValue');
            const submitBtn = overlay.querySelector('#inputDialogSubmit');
            
            submitBtn.onclick = () => {
                const value = input.value.trim();
                closePopup(() => onSubmit && onSubmit(value));
            };
            
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    submitBtn.click();
                }
            });
            
            setTimeout(() => input.focus(), 100);
        }

        // Animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes successPop {
                0% { transform: scale(0); }
                50% { transform: scale(1.2); }
                100% { transform: scale(1); }
            }
            @keyframes errorShake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px); }
                75% { transform: translateX(10px); }
            }
        `;
        document.head.appendChild(style);

        // Override default alert/confirm with liquid glass popups
        window.alert = function(message) {
            // Determine notification type based on message content
            const msg = String(message);
            if (msg.includes('') || msg.toLowerCase().includes('thnh cng') || msg.toLowerCase().includes('success')) {
                showSuccessNotification(msg.replace(/||/g, '').trim());
            } else if (msg.includes('') || msg.toLowerCase().includes('li') || msg.toLowerCase().includes('error')) {
                showErrorNotification(msg.replace(/||/g, '').trim());
            } else {
                showInfoNotification(msg.replace(/||/g, '').trim());
            }
        };

        window.confirm = function(message) {
            return new Promise((resolve) => {
                showConfirmDialog(
                    'Xc Nhn',
                    message.replace(/\\n/g, '<br>'),
                    () => resolve(true)
                );
                // Add cancel handler
                const overlay = document.querySelector('.popup-overlay');
                if (overlay) {
                    const cancelBtn = overlay.querySelector('.btn-secondary');
                    if (cancelBtn) {
                        cancelBtn.onclick = () => {
                            closePopup(() => resolve(false));
                        };
                    }
                }
            });
        };

        // Make confirm async-friendly
        window.confirmAsync = async function(message) {
            return await window.confirm(message);
        };
    </script>

    {% block extra_scripts %}{% endblock %}
</body>
</html>
